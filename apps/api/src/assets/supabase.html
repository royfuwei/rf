<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="5;url=http://localhost:8001/auth/supabase/callback?access_token=eyJhbGciOiJIUzI1NiIsImtpZCI6IjhIUE1oeC9ZNDNJVHpLamEiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzE0MjI2MjU3LCJpYXQiOjE3MTQyMjI2NTcsImlzcyI6Imh0dHBzOi8vZ3lqZHlzcHBneHl1dWphc3NpZ3Uuc3VwYWJhc2UuY28vYXV0aC92MSIsInN1YiI6ImJjMDJkYzVhLThhZmItNGJjZi1hZDQ5LTVkYzE5YTcwYjUwNCIsImVtYWlsIjoicm95ZnV3ZWlAZ21haWwuY29tIiwicGhvbmUiOiIiLCJhcHBfbWV0YWRhdGEiOnsicHJvdmlkZXIiOiJnb29nbGUiLCJwcm92aWRlcnMiOlsiZ29vZ2xlIiwiZ2l0aHViIl19LCJ1c2VyX21ldGFkYXRhIjp7ImF2YXRhcl91cmwiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NMZ29qYm5FNjlHMGlieTBVSm9LY01aOTgtWVZkV0VjZ0ZiYk1NbW5yNDMxa2JqUEpVZT1zOTYtYyIsImVtYWlsIjoicm95ZnV3ZWlAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZ1bGxfbmFtZSI6InJveSBjaHVhbmciLCJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYW1lIjoicm95IGNodWFuZyIsInBob25lX3ZlcmlmaWVkIjpmYWxzZSwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0xnb2pibkU2OUcwaWJ5MFVKb0tjTVo5OC1ZVmRXRWNnRmJiTU1tbnI0MzFrYmpQSlVlPXM5Ni1jIiwicHJvdmlkZXJfaWQiOiIxMDM0MzcwOTcyMjY3ODEzMzUxNTYiLCJzdWIiOiIxMDM0MzcwOTcyMjY3ODEzMzUxNTYifSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJhYWwiOiJhYWwxIiwiYW1yIjpbeyJtZXRob2QiOiJvYXV0aCIsInRpbWVzdGFtcCI6MTcxNDIyMjY1N31dLCJzZXNzaW9uX2lkIjoiNjA2MzVlYzYtOWQ3YS00ZDNlLTk0OWEtM2M5ZTM5N2NlZDUyIiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.m4h7sK02K0SlhnznZ4tRGWKlckSV7V2AY01sDOVORxY&expires_at=1714226257&expires_in=3600&provider_token=ya29.a0Ad52N3-lJmAkvUZCV4A1ZQo-Kut6lVYcYApH8_7BtVX3BhvTmSjCyAGSG1y9j4dhCY9FyNql6IKVTClTf-Ei6N1lXr_zRw0Qy990IzdzTEra8twQnXFvMKF3m9-WOgi2zG4NRqYURdvWL40TW5JLxC3s1nFwOBAMiYEaCgYKAeESARISFQHGX2MitiGfuZFqO451ve3843rm6w0170&refresh_token=4lY5N5kwsM1a7dG9zOQfwg&token_type=bearer">
    <!-- <meta http-equiv="refresh" content="5;url=http://localhost:8001/docs"> -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const hash = window.location.hash.substr(1);  // 获取 URL 中的哈希部分
        const params = new URLSearchParams(hash);  // 哈希通常格式为 query string

        const accessToken = params.get('access_token');  // 获取 access_token
        const expiresAt = params.get('expires_at');

        console.log('Token:', accessToken);
        console.log('Expires At:', expiresAt);

        // 可以选择发送到服务器
        fetch('/auth/supabase/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ accessToken, expiresAt })
        })
        .then(response => response.json())
        .then(data => {
            console.log('Server response:', data);
            window.location.href = '/auth/supabase/callback';  // 重定向到其他页面
            // 创建一个新的 meta 标签
            /* const url = `http://localhost:8001/auth/callback?access_token=${accessToken}&expires_at=${expiresAt}`;
            const meta = document.createElement('meta');
            // <meta http-equiv="refresh" content="5;url=http://localhost:8001/docs">
            meta.name = "refresh";
            meta.content = `5;url=${url}`;

            // 将其添加到 head 标签中
            document.head.appendChild(meta); */
            
            // window.location.replace(`/auth/supabase/callback?access_token=${accessToken}&expires_at=${expiresAt}`);
            // window.href = `/auth/supabase/callback?access_token=${accessToken}&expires_at=${expiresAt}`;
            // window.location.href = `/auth/supabase/callback?access_token=${accessToken}&expires_at=${expiresAt}`;
            // window.location.replace();
            // window.href = `/auth/supabase/callback?access_token=${accessToken}&expires_at=${expiresAt}`;
        })
        .catch(error => console.error('Error posting auth data to server:', error));
    });
    </script>
    <title>Callback Handler</title>
</head>
<body>
    <h1>Processing...</h1>
    <!-- <script src="app.js"></script> -->
    
</body>
</html>